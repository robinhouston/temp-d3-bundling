!function(n,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("d3-dispatch"),require("d3-selection")):"function"==typeof define&&define.amd?define(["exports","d3-dispatch","d3-selection"],e):e(n.d3_drag=n.d3_drag||{},n.d3_dispatch,n.d3_selection)}(this,function(n,e,t){"use strict";function o(){for(var n,e=t.event;n=e.sourceEvent;)e=n;e.preventDefault(),e.stopPropagation()}function i(n){return function(){return n}}function r(n,e,t,o,i,r,c){this.type=n,this.subject=e,this.identifier=t,this.active=o,this.x=i,this.y=r,this._=c}function c(){t.event.on("drag.noclick",null).on("end.noclick",function(){var n="click.noclick-"+t.event.identifier,e=t.select(t.event.sourceEvent.view).on(n,o,!0);setTimeout(function(){e.on(n,null)},0)})}function u(){var n="dragstart.nodrag-"+t.event.identifier,e=t.select(t.event.sourceEvent.view).on(n,o,!0);t.event.on("end.nodrag",function(){e.on(n,null)})}function s(){var n="selectstart.noselect-"+t.event.identifier,e=t.select(t.event.sourceEvent.view).on(n,o,!0);t.event.on("end.noselect",function(){e.on(n,null)})}function a(){var n=this.ownerDocument.documentElement.style,e=n.MozUserSelect;n.MozUserSelect="none",t.event.on("end.noselect",function(){n.MozUserSelect=e})}function f(){return("onselectstart"in this?s:a).apply(this,arguments)}function d(){return!t.event.button}function l(){return this.parentNode}function v(n){return n}function h(){return t.event.subject.x}function p(){return t.event.subject.y}function g(n){function s(n){n.on("mousedown.drag",a).on("touchstart.drag",m).on("touchmove.drag",b).on("touchend.drag touchcancel.drag",w).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function a(){if(k.apply(this,arguments)){var n,e=E.apply(this,arguments);(n=_("mouse",e,t.mouse,this,arguments))&&(t.select(t.event.view).on("mousemove.drag",g).on("mouseup.drag",y),n("start"))}}function g(){z.mouse("drag")}function y(){t.select(t.event.view).on("mousemove.drag mouseup.drag",null),z.mouse("end")}function m(){if(k.apply(this,arguments))for(var n,e=E.apply(this,arguments),o=t.event.changedTouches,i=0,r=o.length;r>i;++i)(n=_(o[i].identifier,e,t.touch,this,arguments))&&n("start")}function b(){for(var n,e=t.event.changedTouches,o=0,i=e.length;i>o;++o)(n=z[e[o].identifier])&&n("drag")}function w(){for(var n,e=t.event.changedTouches,o=0,i=e.length;i>o;++o)(n=z[e[o].identifier])&&n("end")}function _(n,e,o,i,c){var u,s,a,f=o(e,n),d=S.copy();if(t.customEvent(new r("beforestart",a,n,M,f[0],f[1],d),function(){return a=t.event.subject=j.apply(i,c),null==a?!1:(u=x.apply(i,c)-f[0]||0,s=T.apply(i,c)-f[1]||0,!0)}))return function l(v){var h,p;switch(v){case"start":h=f,z[n]=l,p=M++;break;case"end":delete z[n],--M;case"drag":h=o(e,n),p=M}t.customEvent(new r(v,a,n,p,h[0]+u,h[1]+s,d),d.apply,d,[v,i,c])}}var k=d,E=l,j=v,x=h,T=p,z={},M=0,S=e.dispatch("start","drag","end").on("start.nodrag",u).on("start.noselect",f).on("start",n).on("drag.noclick",c).on("drag.noscroll",o);return s.filter=function(n){return arguments.length?(k="function"==typeof n?n:i(!!n),s):k},s.container=function(n){return arguments.length?(E="function"==typeof n?n:i(n),s):E},s.subject=function(n){return arguments.length?(j="function"==typeof n?n:i(n),s):j},s.x=function(n){return arguments.length?(x="function"==typeof n?n:i(+n),s):x},s.y=function(n){return arguments.length?(T="function"==typeof n?n:i(+n),s):T},s.on=function(){var n=S.on.apply(S,arguments);return n===S?s:n},s}var y="0.1.2";r.prototype.on=function(){var n=this._.on.apply(this._,arguments);return n===this._?this:n},n.version=y,n.drag=g});